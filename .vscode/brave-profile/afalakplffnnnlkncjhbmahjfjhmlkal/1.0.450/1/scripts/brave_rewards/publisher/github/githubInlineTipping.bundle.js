(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t;let o=!1;const s=()=>"complete"===document.readyState&&"visible"===document.visibilityState,i="github",r=async e=>{if(!e)throw new Error("Invalid parameters");const t=(e=>e?`https://api.github.com/users/${e}`:"")(e);if(!t)throw new Error("Invalid profile api url");const n=await fetch(t);if(!n.ok){const e=((e,t)=>`Profile API request failed: ${t.statusText} (${t.status})`)(0,n);throw new Error(e)}const o=await n.json();return{user:{id:o.id,screenName:o.login,fullName:o.name||o.login,favIconUrl:o.avatar_url},post:{id:"",timestamp:"",text:""}}},a="action-brave-tip",l="GitHubTip-actionCount",c="IconContainer";let d=null;const m=(e,t)=>{const o=document.createElement("div");o.className="GitHubTip-action js-tooltip "+a,o.style.display="inline-block",o.style.minWidth="40px";const s=document.createElement("button");s.className="GitHubTip-actionButton u-textUserColorHover js-actionButton",s.style.background="transparent",s.style.border="0",s.style.color="#657786",s.style.cursor="pointer",s.style.display="inline-block",s.style.fontSize="16px",s.style.lineHeight="1",s.style.outline="0",s.style.padding="0 2px",s.style.position="relative",s.type="button",s.onclick=function(o){return o.stopPropagation(),t(e).then((e=>{e&&(e=>{if(!e)return;const t=(o=e.user.screenName)?`https://github.com/${o}/`:"";var o;const s=((e,t)=>`${e}#channel:${t}`)(i,e.user.id),r=e.user.fullName,a=e.user.screenName,l=n();l&&l.postMessage({type:"TipUser",mediaType:i,data:{url:t,publisherKey:s,publisherName:r,publisherScreenName:a,favIconUrl:e.user.favIconUrl,postId:e.post.id,postTimestamp:e.post.timestamp,postText:e.post.text}})})(e)}))};const r=document.createElement("div");r.className=c+" js-tooltip",r.style.display="inline-block",r.style.lineHeight="0",r.style.position="relative",r.style.verticalAlign="middle",s.appendChild(r);const d=document.createElement("span");d.className="Icon Icon--medium",d.style.background="transparent",d.style.content=`url("data:image/svg+xml,${encodeURIComponent('<svg fill="inherit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.821 11.1L8.075 6.732v-2.38l4.917 8.195-2.17-1.447zm-6.03.965h5.397l1.752 1.168H2.747l2.043-1.168zm2.13-5.333L4.187 11.08l-1.983 1.133 4.717-7.861v2.38zm.577 1.251l1.841 2.928H5.657l1.841-2.928zm7.42 5.53L7.993 1.97c-.018-.03-.043-.054-.066-.08a.568.568 0 00-.429-.2.57.57 0 00-.43.2c-.022.026-.047.05-.064.08L.079 13.513a.59.59 0 00-.061.143c-.002.004-.002.007-.002.01a.571.571 0 00-.008.237.56.56 0 00.064.193c.01.017.023.029.034.044.02.026.037.055.06.077.021.022.047.038.071.057.017.011.031.025.048.035.027.016.056.025.085.036.018.007.035.016.054.022a.597.597 0 00.132.017c.006 0 .012.003.017.003h13.85a.576.576 0 00.495-.874z" fill="#6A7684"/></svg>')}")`,d.style.display="inline-block",d.style.fontSize="18px",d.style.fontStyle="normal",d.style.height="16px",d.style.marginTop="3px",d.style.position="relative",d.style.verticalAlign="baseline",d.style.width="16px",r.appendChild(d);const m=document.createElement("span");m.className=l,m.style.color="#657786",m.style.display="inline-block",m.style.fontSize="12px",m.style.fontWeight="bold",m.style.lineHeight="1",m.style.marginLeft="1px",m.style.position="relative",m.style.verticalAlign="text-bottom",s.appendChild(m);const p=document.createElement("span");p.className="GitHubTip-actionCountForPresentation";const h=chrome.i18n.getMessage("githubTipsIconLabel");h&&(p.textContent=h),m.appendChild(p);const u=o.attachShadow({mode:"open"});u.appendChild(s);const f=document.createElement("style");return f.appendChild(document.createTextNode(".GitHubTip-actionButton :hover { color: #6781db }")),u.appendChild(f),o},p=async e=>{let t=e.closest(".timeline-comment-header");if(t=t||e.closest(".review-comment"),!t)throw new Error("Failed to parse DOM");const n=t.getElementsByClassName("author");if(!n||0===n.length)throw new Error("Failed to parse DOM");const o=n[0].textContent;if(!o)throw new Error("Missing screen name");return r(o)},h=e=>{if(!e)return;const t=m(e,p);if(!t||!t.shadowRoot)return;t.style.marginRight="2px";const n=t.shadowRoot.querySelector(`.${c}`);n&&(n.style.paddingBottom="5px");const o=t.shadowRoot.querySelector(`.${l}`);o&&(o.style.paddingBottom="2px");const s=e.childNodes;if(!s||s.length<2)return;const i=s[s.length-2];e.insertBefore(t,i)},u=async e=>{if(!e)throw new Error("Invalid arguments");const t=e.getElementsByClassName("avatar");if(!t||0===t.length)throw new Error("Failed to parse DOM");const n=t[0];if(!n)throw new Error("Failed to parse DOM");const o=n.children;if(!o||0===o.length)throw new Error("Failed to parse DOM");const s=o[0].alt.slice(1);if(!s)throw new Error("Missing screen name");return r(s)},f=e=>{if(!e)return;const t=m(e,u);t&&(t.style.marginTop="4px",t.style.marginLeft="9px",e.appendChild(t))},g=async e=>{if(!e)throw new Error("Invalid arguments");const t=e.closest(".d-block");if(!t)throw new Error("Failed to parse DOM");const n=t.getElementsByTagName("A");if(!n||0===n.length)throw new Error("Failed to parse DOM");const o=n[0];if(!o.href)throw new Error("Failed to parse DOM");const s=o.href.split("/");if(s.length<4)throw new Error("Failed to parse DOM");const i=s[3];if(!i)throw new Error("Missing screen name");return r(i)},y=e=>{if(!e)return;if(!(e=>{if(!e)return!1;const t=new URLSearchParams(e);if(!t||!t.has("tab"))return!1;const n=t.get("tab");return!!n&&!!["stars"].includes(n)})(window.location.search))return;const t=e.getElementsByClassName("d-inline-block");if(!t||0===t.length)return;const n=m(e,g);n.classList.add("d-inline-block"),n.style.minWidth="60px",e.insertBefore(n,t[0])},w=async e=>{const t=document.getElementsByClassName("gisthead");if(!t||0===t.length)throw new Error("Failed to parse DOM");const n=t[0].getElementsByClassName("author");if(!n||0===n.length)throw new Error("Failed to parse DOM");const o=n[0].getElementsByTagName("A");if(!o||0===o.length)throw new Error("Failed to parse DOM");const s=o[0].textContent;if(!s)throw new Error("Missing screen name");return r(s)},b=e=>{if(!e)return;const t=window.location.host.split(".");if(!t||t.length<1)return;if("gist"!==t[0]||window.location.pathname.slice(1).split("/").length<2)return;const n=m(e,w);e.appendChild(n)},E=(e,t)=>{const n=document.getElementsByClassName(e);if(n)for(let e=0;e<n.length;++e){const o=n[e];o&&(0===o.getElementsByClassName(a).length&&t(o))}},v=()=>{clearTimeout(d),E("timeline-comment-actions",h),E("js-commits-list-item",f),E("float-right",y),E("pagehead-actions",b),d=setTimeout(v,3e3)},x=(e,t)=>{for(const{removedNodes:t}of e)for(const e of t){if(e.nodeType!==Node.ELEMENT_NODE)continue;const t=e;if(t.classList.contains("timeline-comment-header"))return void v();if(t.hasChildNodes()){const e=t.getElementsByClassName("timeline-comment-header");if(e&&e.length>0)return void v()}}},N=document.getElementById("discussion_bucket");N&&new MutationObserver(x).observe(N,{childList:!0,subtree:!0});let C="";const T=e=>{e&&(e.url||"complete"===e.status)&&location.href!==C&&(C=location.href,v())};var M;chrome.extension.inIncognitoContext||(M=e=>{e?(s()?v():document.addEventListener("readystatechange",(function(){s()&&v()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&v()})),((e,t)=>{if(o)return;o=!0;const s=n();s&&(s.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),s.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(i,T)):console.error("Failed to initialize communications port")},t?M(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),M(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),M(!0))}),100)),console.info("Greaselion script loaded: githubInlineTipping.ts"))})();