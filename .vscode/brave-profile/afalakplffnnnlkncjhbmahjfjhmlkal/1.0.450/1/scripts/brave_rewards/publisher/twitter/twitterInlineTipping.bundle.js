(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t;let r=!1,s=!1;const o=()=>"complete"===document.readyState&&"visible"===document.visibilityState,i=["authorization","x-csrf-token","x-guest-token"],a=/[; ]_twitter_sess=([^\s;]*)/;let l=null,c={};const d=e=>{if(!e)return null;const t=e.match(a);return t?unescape(t[1]):null},u=()=>c,m=()=>c.authorization&&(c["x-csrf-token"]&&c["x-twitter-auth-type"]||c["x-csrf-token"]&&c["x-guest-token"]),p="twitter",f=["https://api.twitter.com/1.1/*"],h=["requestHeaders","extraHeaders"];let y=0;const g=(e,t)=>{if(!e)return null;if(!t)return e.getAttribute("data-tweet-id");const n=e.querySelector("a[href*='/status/']");if(!n||!n.href)return null;const r=n.href.match(/status\/(\d+)/);return!r||r.length<2?null:r[1]};let v=null,w=!0;const b=(e,t)=>e&&t?(async e=>{return e?(t="GetTweetDetails",r=`https://api.twitter.com/1.1/statuses/show.json?id=${e}`,new Promise(((e,s)=>{if(!t||!r)return void s(new Error("Invalid parameters"));if(!m())return void s(new Error("Missing auth headers"));const o=n();if(!o)return void s(new Error("Invalid port"));if(0!==y&&Date.now()-y<3e3)return void s(new Error("Ignoring API request due to network throttle"));y=Date.now();const i=u();o.postMessage({type:"OnAPIRequest",mediaType:p,data:{name:t,url:r,init:{credentials:"include",headers:{...i},referrerPolicy:"no-referrer-when-downgrade",method:"GET",redirect:"follow"}}}),o.onMessage.addListener((function n(r){if(o){if(!r||!r.data)return o.onMessage.removeListener(n),void s(new Error("Invalid message"));if("OnAPIResponse"===r.type){if(!r.data.name||!r.data.response&&!r.data.error)return o.onMessage.removeListener(n),void s(new Error("Invalid message"));if(r.data.name===t){if(o.onMessage.removeListener(n),r.data.error)return void s(new Error(r.data.error));e(r.data.response)}}}else s(new Error("Invalid port"))}))}))):Promise.reject(new Error("Invalid parameters"));var t,r})(t).then((e=>({user:{id:e.user.id_str,screenName:e.user.screen_name,fullName:e.user.name,favIconUrl:e.user.profile_image_url_https.replace("_normal","")},post:{id:t,timestamp:e.created_at,text:e.text}}))).catch((e=>(console.error(`Failed to fetch tweet details for ${t}: ${e.message}`),Promise.reject(e)))):Promise.reject(new Error("Invalid parameters")),x=e=>{if("Enter"!==e.key&&"Space"!==e.code)return;const t=e.target;if(!t)return;const n=t.shadowRoot;if(!n)return;const r=n.querySelector(".js-actionButton");r&&r.click()},E=(e,t,n)=>{const r=document.createElement("div");r.className="ProfileTweet-action js-tooltip action-brave-tip",r.style.display="inline-flex",r.style.textAlign=n?"right":"start",r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.addEventListener("keydown",x);const s=document.createElement("button");s.className="ProfileTweet-actionButton u-textUserColorHover js-actionButton",s.style.background="transparent",s.style.border="0",s.style.color="#657786",s.style.cursor="pointer",s.style.display="inline-block",s.style.fontSize="16px",s.style.lineHeight="1",s.style.outline="0",s.style.paddingBottom="2px",s.style.position="relative",s.type="button",s.onclick=function(n){if(w)b(e,t).then((e=>{e&&T(e)})).catch((t=>{console.error(`Failed to fetch tweet metadata for ${e}:`,t)}));else{const n=((e,t)=>{if(!e)return null;const n=e.getElementsByClassName("tweet-text");if(!n||0===n.length)return null;const r=n[0],s=e.getElementsByClassName("js-short-timestamp");if(!s||0===s.length)return null;const o=s[0].getAttribute("data-time")||"";return{user:{id:e.getAttribute("data-user-id")||"",screenName:e.getAttribute("data-screen-name")||"",fullName:e.getAttribute("data-name")||"",favIconUrl:""},post:{id:t,timestamp:o,text:r.innerText||""}}})(e,t);n&&T(n)}n.stopPropagation()};const o=document.createElement("div");o.className="IconContainer js-tooltip",o.style.display="inline-block",o.style.lineHeight="0",o.style.position="relative",o.style.verticalAlign="middle",s.appendChild(o);const i=document.createElement("span");i.className="Icon Icon--medium",i.style.background="transparent",i.style.content=`url("data:image/svg+xml,${encodeURIComponent('<svg fill="inherit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.821 11.1L8.075 6.732v-2.38l4.917 8.195-2.17-1.447zm-6.03.965h5.397l1.752 1.168H2.747l2.043-1.168zm2.13-5.333L4.187 11.08l-1.983 1.133 4.717-7.861v2.38zm.577 1.251l1.841 2.928H5.657l1.841-2.928zm7.42 5.53L7.993 1.97c-.018-.03-.043-.054-.066-.08a.568.568 0 00-.429-.2.57.57 0 00-.43.2c-.022.026-.047.05-.064.08L.079 13.513a.59.59 0 00-.061.143c-.002.004-.002.007-.002.01a.571.571 0 00-.008.237.56.56 0 00.064.193c.01.017.023.029.034.044.02.026.037.055.06.077.021.022.047.038.071.057.017.011.031.025.048.035.027.016.056.025.085.036.018.007.035.016.054.022a.597.597 0 00.132.017c.006 0 .012.003.017.003h13.85a.576.576 0 00.495-.874z" fill="#6A7684"/></svg>')}")`,i.style.display="inline-block",i.style.fontSize="18px",i.style.fontStyle="normal",i.style.height="16px",i.style.marginTop="2px",i.style.position="relative",i.style.verticalAlign="baseline",i.style.width="16px",o.appendChild(i);const a=document.createElement("span");a.className="ProfileTweet-actionCount",a.style.color="#657786",a.style.display="inline-block",a.style.fontSize="12px",a.style.fontWeight="bold",a.style.lineHeight="1",a.style.marginLeft="6px",a.style.position="relative",a.style.verticalAlign="text-bottom",s.appendChild(a);const l=document.createElement("span");l.className="ProfileTweet-actionCountForPresentation",l.textContent=chrome.i18n.getMessage("twitterTipsIconLabel"),a.appendChild(l);const c=r.attachShadow({mode:"open"});c.appendChild(s);const d=document.createElement("style");return d.appendChild(document.createTextNode(".ProfileTweet-actionButton :hover { color: #6781db }")),c.appendChild(d),r},T=e=>{if(!e)return;const t=(r=e.user.screenName,s=e.user.id,r?s?`https://twitter.com/intent/user?user_id=${s}&screen_name=${r}`:`https://twitter.com/${r}/`:"");var r,s;const o=`${p}#channel:${e.user.id}`;const i=e.user.screenName,a=e.user.screenName,l=n();l&&l.postMessage({type:"TipUser",mediaType:p,data:{url:t,publisherKey:o,publisherName:i,publisherScreenName:a,favIconUrl:e.user.favIconUrl,postId:e.post.id,postTimestamp:e.post.timestamp,postText:e.post.text}})},I=()=>{clearTimeout(v),w=!0;let e=document.querySelectorAll('[role="article"]');0===e.length&&(e=document.querySelectorAll(".tweet"),w=!1);for(let t=0;t<e.length;++t){const n=g(e[t],w);if(!n)continue;let r;if(w){const n=e[t].querySelectorAll('[role="group"]');for(let e of n){const t=e.querySelectorAll('[role="button"]');if(t&&!(t.length<3)){r=e;break}}!r&&n.length>0&&(r=n[n.length-1])}else r=e[t].querySelector(".js-actions");if(r&&0===r.getElementsByClassName("action-brave-tip").length){const s=(r.querySelectorAll(":scope > div").length||0)>3,o=E(e[t],n,s);r.appendChild(o)}}v=setTimeout(I,3e3)},N=(e,t)=>{e===p&&t&&t.requestHeaders&&(e=>{if(!e)return!1;let t={};for(const n of e)if("Cookie"===n.name){const e=d(n.value);e!==l&&(l=e,t={})}else(i.includes(n.name)||n.name.startsWith("x-twitter-"))&&(t[n.name]=n.value);return"yes"!==t["x-twitter-active-user"]&&(t["x-twitter-active-user"]="yes"),!((e,t)=>{const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++){const s=n[r];if(e[s]!==t[s])return!1}return!0})(c,t)&&(c=t,!0)})(t.requestHeaders)&&I()},S=e=>{e&&e.url&&I()};var k;chrome.extension.inIncognitoContext||(k=e=>{e?(o()?I():document.addEventListener("readystatechange",(function(){o()&&I()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&I()})),((e,t,r,o)=>{if(s)return;s=!0;const i=n();i&&(i.postMessage({type:"RegisterOnSendHeadersWebRequest",mediaType:e,data:{urlPatterns:t,extra:r}}),i.onMessage.addListener((function(e){e.data&&"OnSendHeadersWebRequest"===e.type&&o(e.mediaType,e.data.details)})))})(p,f,h,N),((e,t)=>{if(r)return;r=!0;const s=n();s&&(s.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),s.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(p,S)):console.error("Failed to initialize communications port")},t?k(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),k(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),k(!0))}),100)),console.info("Greaselion script loaded: twitterInlineTipping.ts"))})();