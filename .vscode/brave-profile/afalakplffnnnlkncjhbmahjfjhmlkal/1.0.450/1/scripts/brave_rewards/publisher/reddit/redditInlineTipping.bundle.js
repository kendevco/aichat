(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t;let o=!1;const s=()=>"complete"===document.readyState&&"visible"===document.visibilityState,a="reddit",r=(e,t)=>{if(!e)return"";let n="www";return t&&(n="old"),`https://${n}.reddit.com/user/${e}/`},i=async(e,t)=>{if(!e)throw new Error("Invalid parameters");const n=r(e,t);if(!n)throw new Error("Invalid profile url");const o=n+"about.json",s=await fetch(o);if(!s.ok){const e=((e,t)=>`Profile request failed: ${t.statusText} (${t.status})`)(0,s);throw new Error(e)}const a=await s.text();if(!a)throw new Error("Profile response is empty");const i=JSON.parse(a);if(!i)throw new Error("Unable to parse profile response");if("t2"!==i.kind||!i.data)throw new Error("Unexpected profile response data");return i.data},l=200;let c=null;const d=()=>{const e=document.createElement("span");return e.className="IconContainer",e},m=()=>{const e=document.createElement("span");return e.className="tip-icon--medium",e.style.background="transparent",e.style.content=`url("data:image/svg+xml,${encodeURIComponent('<svg fill="inherit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.821 11.1L8.075 6.732v-2.38l4.917 8.195-2.17-1.447zm-6.03.965h5.397l1.752 1.168H2.747l2.043-1.168zm2.13-5.333L4.187 11.08l-1.983 1.133 4.717-7.861v2.38zm.577 1.251l1.841 2.928H5.657l1.841-2.928zm7.42 5.53L7.993 1.97c-.018-.03-.043-.054-.066-.08a.568.568 0 00-.429-.2.57.57 0 00-.43.2c-.022.026-.047.05-.064.08L.079 13.513a.59.59 0 00-.061.143c-.002.004-.002.007-.002.01a.571.571 0 00-.008.237.56.56 0 00.064.193c.01.017.023.029.034.044.02.026.037.055.06.077.021.022.047.038.071.057.017.011.031.025.048.035.027.016.056.025.085.036.018.007.035.016.054.022a.597.597 0 00.132.017c.006 0 .012.003.017.003h13.85a.576.576 0 00.495-.874z" fill="#6A7684"/></svg>')}")`,e.style.height="20px",e.style.verticalAlign="middle",e.style.width="20px",e},u=e=>e?e.querySelector('button[aria-label="more options"]'):null,p=e=>{const t=e.querySelector('button[aria-label="more options"]');return t?t.nextElementSibling||t.previousElementSibling||!t.parentElement?t:t.parentElement:null},h=e=>document.evaluate(".//button[text()='Save']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,f=e=>{const t=document.evaluate(".//span[text()='save']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return t&&t.parentElement&&t.parentElement.parentElement?t.parentElement.parentElement:null},g=e=>{const t=(()=>{const e=document.createElement("li");return e.className="action-brave-tip",e})(),n=document.createElement("span");t.appendChild(n);const o=d(),s=m();o.appendChild(s);const a=(()=>{const e=document.createElement("a");return e.className="reddit-actionButton",e.href="javascript:void(0)",e.textContent=chrome.i18n.getMessage("redditTipsIconLabel"),e})();a.appendChild(o),a.onclick=function(t){return t.stopPropagation(),(async e=>{if(!e)throw new Error("Invalid parameters");let t="";const n=e.querySelector('a[data-event-action="title"]'),o=e.getElementsByClassName("md");if(o&&0!==o.length){const e=o[0];e&&e.innerText&&(t=e.innerText)}else t=n&&n.innerText?n.innerText:"";t.length>l&&(t=t.substr(0,l)+"...");let s,a="";const r=e.getElementsByClassName("entry");if(r&&(s=r[0].getElementsByClassName("author")),s&&s.length>0){const e=s[0];e&&e.textContent&&(a=e.textContent)}let c="";const d=e.getElementsByTagName("time");d&&d.length>0&&(c=d[0].textContent||"");const m=await i(a,!0);return{user:{id:m.id,screenName:a,fullName:m.name,favIconUrl:m.icon_img},post:{id:"",timestamp:c,text:t||""}}})(e).then((e=>{e&&T(e)}))};const r=n.attachShadow({mode:"open"});return r.appendChild(o),r.appendChild(a),r.appendChild((()=>{const e=document.createElement("style");return e.appendChild(document.createTextNode(".reddit-actionButton { color: #888; font-weight: bold; paddings: 0 1px; text-decoration: none } .reddit-actionButton:hover { text-decoration: underline }")),e})()),t},y=(e,t)=>{const n=(e=>{const t=document.createElement("div");return t.className="action-brave-tip",e&&(t.style.display="flex",t.style.alignItems="center"),t})(t),o=(()=>{const e=document.createElement("button");e.className="reddit-actionButton",e.style.background="transparent",e.style.border="none",e.style.borderRadius="2px",e.style.color="inherit",e.style.cursor="pointer",e.style.font="inherit",e.style.height="100%",e.style.padding="8px",e.style.width="auto",e.type="button";const t=document.createElement("style");return t.appendChild(document.createTextNode(".reddit-actionButton {}")),e.appendChild(t),e})();o.onclick=function(t){return t.stopPropagation(),(async e=>{if(!e)throw new Error("Invalid parameters");let t="",n=e.getElementsByTagName("p");if(n&&0!==n.length){const e=n[0].parentElement;e&&e.innerText&&(t=e.innerText)}else n=e.getElementsByTagName("h3"),n&&n.length>0?n[0].innerText&&(t=n[0].innerText):(n=e.getElementsByTagName("h1"),n&&n.length>0&&n[0].innerText&&(t=n[0].innerText));t.length>l&&(t=t.substr(0,l)+"...");let o="";const s=e.querySelectorAll('a[href^="/user/"]:not([data-click-id="body"]):not([data-click-id="subreddit"])');for(const e of s)if(e&&e.textContent){o=e.textContent.startsWith("u/")?e.textContent.split("/")[1]:e.textContent;break}let a="";const r=e.querySelector('a[data-click-id="timestamp"]');if(r)a=r.textContent||"";else{const t=e.querySelector('div[data-test-id="comment"]');if(t){const e=t.previousElementSibling;if(e){const t=e.getElementsByTagName("a");if(t&&t.length>1){const e=t[1].getElementsByTagName("span");e&&e.length>0&&(a=e[0].textContent||"")}}}}const c=await i(o,!1);return{user:{id:c.id,screenName:o,fullName:c.name,favIconUrl:c.icon_img},post:{id:"",timestamp:a,text:t||""}}})(e).then((e=>{e&&T(e)}))};const s=d();o.appendChild(s);const a=m();s.appendChild(a);const r=(()=>{const e=document.createElement("span");return e.className="reddit-actionCount",e.style.color="inherit",e.style.lineHeight="12px",e.style.margin="0",e.style.verticalAlign="middle",e})();o.appendChild(r);const c=(()=>{const e=document.createElement("span");return e.className="reddit-actionButton",e.textContent=chrome.i18n.getMessage("redditTipsIconLabel"),e})();r.appendChild(c);const u=n.attachShadow({mode:"open"});u.appendChild(o);const p=(()=>{const e=document.createElement("style");return e.appendChild(document.createTextNode(":host { outline: none } :host(:hover) { background-color: var(--newRedditTheme-navIconFaded10) }")),e})();return u.appendChild(p),n},E=(e,t,n)=>{e&&t&&n&&t.insertAdjacentElement("afterend",y(e,n.posts))},v=(e,t,n)=>{e&&t&&n&&(n.usersPost||n.posts?t.parentElement&&t.parentElement.insertAdjacentElement("beforebegin",y(e,n.posts)):t.insertAdjacentElement("beforebegin",y(e,n.posts)))},b=e=>{if(!e)return;const t=e.posts?document.getElementsByClassName("Post"):document.getElementsByClassName("Comment");var n;if(t)for(const o of t){const t=(n=o,Boolean(document.evaluate(".//button[text()='edit']",n,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)),s=o.querySelectorAll("div.action-brave-tip"),a=o.querySelector('div[data-test-id="comment-submission-form-richtext"');if(s.length>0||a)continue;const r=e.promotedPosts?f(o):h(o);if(r)E(o,r,e);else{const n=e.posts?p(o):u(o);if(n){const s={posts:e.posts,usersPost:t};v(o,n,s)}}}},x=e=>{const t=document.querySelectorAll(`div[data-type="${e}"]`);if(t)for(const e of t){if(e.querySelectorAll("li.action-brave-tip").length>0)continue;const t=e.getElementsByClassName("flat-list");if(0===t.length)continue;const n=g(e);t[0].insertAdjacentElement("beforeend",n)}},T=e=>{const t=n();if(!t)return;const o=((e,t)=>`${e}#channel:${t}`)(a,e.user.id),s=e.user.fullName,i=e.user.screenName,l=r(e.user.screenName,!1);t.postMessage({type:"TipUser",mediaType:a,data:{url:l,publisherKey:o,publisherName:s,publisherScreenName:i,favIconUrl:e.user.favIconUrl,postId:e.post.id,postTimestamp:e.post.timestamp,postText:e.post.text}})},N=()=>{var e;clearTimeout(c),(e=new URL(location.href)).hostname.startsWith("old.")||e.hostname.startsWith("np.")?(x("comment"),x("link")):(b({posts:!1,promotedPosts:!1}),b({posts:!0,promotedPosts:!1}),b({posts:!0,promotedPosts:!0})),c=setTimeout(N,3e3)};let C="";const w=e=>{e&&(e.url||"complete"===e.status)&&location.href!==C&&(C=location.href,N())};var S;chrome.extension.inIncognitoContext||(S=e=>{e?(s()?N():document.addEventListener("readystatechange",(function(){s()&&N()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&N()})),((e,t)=>{if(o)return;o=!0;const s=n();s&&(s.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),s.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(a,w)):console.error("Failed to initialize communications port")},t?S(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),S(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),S(!0))}),100)),console.info("Greaselion script loaded: redditInlineTipping.ts"))})();